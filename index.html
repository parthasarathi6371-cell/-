// 1. SETUP MATERIALS
const heartColor = 0x990000;

// Epicardium: The outer protective layer
const epicardiumMat = new THREE.MeshPhongMaterial({
    color: heartColor,
    transparent: true,
    opacity: 0.3, // As requested
    shininess: 100,
    side: THREE.DoubleSide
});

// Myocardium: The thick muscle (The "Engine")
const myocardiumMat = new THREE.MeshPhongMaterial({
    color: 0x800000,
    flatShading: false,
    shininess: 10
});

// Endocardium: The inner lining
const endocardiumMat = new THREE.MeshPhongMaterial({
    color: 0x440000,
    visible: false // Hidden by default
});

// 2. CREATE GEOMETRY (Heart Shape via Scaling a Sphere)
const geo = new THREE.SphereGeometry(1, 32, 32);
// Apply a simple deformation to make it heart-shaped
const position = geo.attributes.position;
for (let i = 0; i < position.count; i++) {
    let y = position.getY(i);
    // Taper the bottom (Apex) and widen the top (Base)
    let scale = 1 - (y + 1) * 0.3; 
    position.setX(i, position.getX(i) * scale);
    position.setZ(i, position.getZ(i) * scale);
}

// 3. INSTANTIATE LAYERS
const myocardium = new THREE.Mesh(geo, myocardiumMat);
const epicardium = new THREE.Mesh(geo, epicardiumMat);
const endocardium = new THREE.Mesh(geo, endocardiumMat);

// Scale layers slightly to nest them
epicardium.scale.set(1.05, 1.05, 1.05);
endocardium.scale.set(0.95, 0.95, 0.95);

const heartGroup = new THREE.Group();
heartGroup.add(myocardium, epicardium, endocardium);
scene.add(heartGroup);

// 4. ANIMATION LOOP (The Heartbeat)
function animate() {
    requestAnimationFrame(animate);
    
    // Pulse math: Sin wave creates a rhythmic contraction
    let time = Date.now() * 0.005;
    let pulse = 1 + Math.sin(time) * 0.1; 
    
    // Only the Myocardium and Epicardium scale significantly
    myocardium.scale.set(pulse, pulse, pulse);
    epicardium.scale.set(pulse * 1.05, pulse * 1.05, pulse * 1.05);
    
    renderer.render(scene, camera);
}
  
